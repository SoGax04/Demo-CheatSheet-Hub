以下は「プログラミング言語のチートシートを掲示するためのサイト」を制作しやすい形に落とした**要件定義書（UI除外）**です。
※文中の「チートシート」は、特定言語やツールの要点・例・注意点を短く整理したページ（または1枚）を指します。

---

# 要件定義書：プログラミング言語チートシート掲示サイト（UI除外）

## 1. 目的・背景

### 1.1 目的

* プログラミング言語・関連ツール（フレームワーク、CLI、DB、正規表現等）のチートシートを、**誰でも素早く参照できる**形で提供する。
* チートシートの作成・更新を容易にし、**継続的にメンテできる運用**を実現する。

### 1.2 背景・課題

* 情報が散在している／古い／信頼性が分からない
* 欲しい情報に辿り着くまでに時間がかかる
* 更新・追加のたびに構造が崩れ、運用が辛くなる

### 1.3 成功指標（例）

* チートシート追加・修正が「1ページあたり10分〜」で行える
* 検索から目的のページに到達するまでが「数クリック」前提（UIは別途）
* 更新履歴・更新者が追跡でき、ロールバック可能

---

## 2. スコープ

### 2.1 対象範囲（In Scope）

* チートシートの作成、公開、更新、削除、バージョン管理
* タグ/カテゴリ/言語/用途別の整理
* 検索・フィルタ・並び替え（機能面）
* 権限管理（最低限の編集権限）
* SEO/OGP 等のメタ情報管理（UIではなく機能要件として）
* API（必要なら）および管理用機能
* 運用（バックアップ、ログ、監視、デプロイ、障害対応）

### 2.2 対象外（Out of Scope）

* 具体的な画面デザイン、レイアウト、配色、コンポーネント設計
* 課金機能（必要なら追加要件化）
* コミュニティ（コメント、掲示板、フォーラム）※将来拡張候補

---

## 3. 想定ユーザーと権限（ロール）

最低限この3ロールで設計すると運用が安定します。

1. **閲覧者（Guest）**

* 公開チートシートの閲覧
* 検索・フィルタ・タグ閲覧
* （任意）お気に入り（ログイン不要のローカル保存 or ログイン式）

2. **編集者（Editor）**

* チートシートの新規作成、編集、下書き保存
* 公開申請（承認フローがある場合）

3. **管理者（Admin）**

* チートシートの公開/非公開切替
* 編集者の管理、権限付与
* タグ/カテゴリ辞書の管理
* 監査ログ閲覧、ロールバック

※小規模運用なら「Editor=Admin」でもOK。将来を考えるなら分離推奨。

---

## 4. コンテンツ要件（チートシートの定義）

### 4.1 チートシートの構成要素（データモデル）

* **基本情報**

  * ID（不変）
  * タイトル
  * 対象（言語/ツール名）
  * 概要（短文）
  * スラッグ（URL用、ユニーク）
  * 公開状態（draft / published / archived）
  * 作成者、最終更新者
  * 作成日時、更新日時、公開日時
  * バージョン（整数またはセマンティック）
  * ライセンス（CC BY等、任意）

* **分類**

  * カテゴリ（例：Language / Framework / DB / CLI / DevOps / Regex）
  * タグ（複数）
  * 難易度（任意：beginner/intermediate/advanced）
  * 用途（例：基本文法、テスト、パフォーマンス、配列操作等）

* **本文**

  * 見出し構造（セクション/サブセクション）
  * コードブロック（言語指定、コピー可能を想定）
  * 注意点（警告/推奨）
  * 参考リンク（公式ドキュメント等）
  * 関連チートシート（内部リンク）

* **メタ（SEO/共有）**

  * description（OGP/SEO）
  * keywords（任意）
  * og:image（任意、未指定時のデフォルト生成でも可）

### 4.2 記述フォーマット

制作容易性の観点から推奨：

* **Markdown（Front Matter付）** または **MDX**
* フロントマター（YAML/JSON/TOML）でメタ情報を持つ

例（YAML）：

* title, slug, category, tags, status, summary, updatedAt, version, references, relatedIds…

### 4.3 コードブロック要件（UIではなく機能）

* コードブロックに言語指定ができる（例：```python）
* 将来的な要件として「コピー」「行番号」「ハイライト」を実現可能な構造で保持する

---

## 5. 機能要件（Functional Requirements）

## 5.1 閲覧機能

* 公開状態（published）のチートシートを閲覧できる
* 一意URL（slug）でアクセス可能
* カテゴリ/タグ/対象言語で一覧取得ができる
* 関連チートシート（同タグ、同カテゴリ等）を辿れる（出力できる）

**受け入れ基準（例）**

* publishedのみが一般公開され、draftは直接URLでも閲覧不可（権限者のみ）
* slugが重複しない

---

## 5.2 検索・フィルタ

* 検索対象

  * タイトル
  * 概要
  * タグ/カテゴリ
  * 本文（全文検索）
* フィルタ

  * カテゴリ
  * タグ
  * 対象言語/ツール
  * 難易度（任意）
* 並び替え

  * 更新日時（新しい順）
  * 人気順（任意：PV/いいね）
  * タイトル順

**受け入れ基準（例）**

* 検索クエリに対して、タイトル一致は本文一致より優先度が高い
* フィルタは複合指定できる（カテゴリ×タグ 等）

---

## 5.3 編集（CMS）機能

* チートシート作成

  * 下書き（draft）保存
  * プレビュー（レンダリング確認）
* チートシート編集

  * 変更差分（diff）確認（最低限、更新履歴が追える）
* 公開/非公開

  * draft → published（管理者のみ、または承認フロー）
  * published → archived（非公開化、URLは404 or アーカイブ表示方針で要件化）
* 削除

  * 基本は論理削除推奨（復元可能）
* 画像/添付（任意）

  * OGP画像や図のアップロード or 外部URL参照

**受け入れ基準（例）**

* Editorはdraft作成と編集ができる
* 公開はAdminのみ（または「承認」ステータスを追加）

---

## 5.4 バージョン管理・履歴

* 更新履歴（誰がいつ何を変更したか）
* ロールバック（特定バージョンへ戻す）
* バージョン番号の自動採番（保存時+1）

**受け入れ基準（例）**

* 変更が保存されるたびに履歴が1件生成される
* Adminが任意の履歴へロールバックできる

---

## 5.5 タグ・カテゴリ辞書管理

* タグの新規作成、名称変更、統合（Aタグ→Bタグへ付け替え）
* カテゴリの追加・名称変更
* 禁則文字や同義語（alias）対応（任意）

**受け入れ基準（例）**

* タグ名はユニーク（大小区別方針を決める）
* 統合すると対象チートシートの紐付けが一括更新される

---

## 5.6 認証・認可

* 認証方式（いずれか）

  * メール+パスワード
  * OAuth（GitHub/Google）
  * もしくは「管理者だけ」運用ならベーシック認証＋IP制限でも可（小規模）
* 認可（RBAC）

  * Guest: read published
  * Editor: create/update own drafts（＋他者編集可否はポリシー化）
  * Admin: all

**受け入れ基準（例）**

* 権限のないユーザーは管理APIへアクセスできない
* セッション/トークンは期限付き

---

## 5.7 監査ログ（最低限）

* 重要操作を記録

  * ログイン/ログアウト（任意）
  * 作成/更新/公開/アーカイブ/削除/ロールバック
  * タグ統合、権限変更
* 監査ログの閲覧（Admin）

---

## 5.8 分析（任意）

* ページビュー、人気コンテンツ、検索キーワード（個人情報に配慮）
* 収集は最小限（例：匿名集計）

---

## 5.9 API要件（必要なら）

将来的にモバイルや外部連携を見据えるなら、以下を用意。

* Public API（read-only）

  * GET /cheatsheets（フィルタ、ページング）
  * GET /cheatsheets/{slug}
  * GET /tags, /categories
* Admin API（認証必須）

  * POST/PUT/PATCH/DELETE cheatsheets
  * POST tags merge 等

---

## 6. 非機能要件（Non-Functional Requirements）

## 6.1 パフォーマンス

* 一覧表示（検索/フィルタ）応答：目安 300〜800ms（同一リージョン）
* ページキャッシュ（CDNやSSRキャッシュ等）を採用可能な構造
* 全文検索は簡易（DB LIKE）ではなく、規模に応じて検索エンジン導入可能にする

## 6.2 可用性・運用

* デプロイは自動化（CI/CD）
* 障害時の復旧手順を用意（バックアップ→リストア）
* 監視

  * アプリログ、エラーログ（例：5xx率）
  * リソース監視（CPU/メモリ）
* バックアップ

  * DB：日次
  * 画像ストレージ：世代管理（任意）

## 6.3 セキュリティ

* 主要対策

  * CSRF（セッション方式の場合）
  * XSS（Markdownレンダリングのサニタイズ）
  * SQLi（ORM等）
  * レート制限（ログイン、検索API）
* 機密情報の取り扱い

  * 環境変数管理
  * secretsのローテーション（運用規模に応じて）

## 6.4 保守性

* チートシート本文とメタ情報が分離され、移行しやすい
* テスト

  * 権限テスト
  * レンダリングテスト（Markdown→HTML）
  * APIスキーマテスト

## 6.5 拡張性

* 多言語対応（日本語/英語など）を将来追加できる設計

  * cheatsheet_translations テーブル or ファイル構造で対応
* バージョンごとのチートシート（言語のバージョン別：Python 3.10/3.12）にも対応できるフィールド

  * target_version（例：3.12）など

---

## 7. データ設計（例）

実装方式に依存しないよう、概念モデルとして記載します。

### 7.1 エンティティ

* CheatSheet
* Tag
* Category
* User
* Revision（履歴）
* AuditLog

### 7.2 リレーション

* CheatSheet 1 - N Revision
* CheatSheet N - N Tag
* Category 1 - N CheatSheet
* User 1 - N CheatSheet（作成者/更新者）
* User 1 - N AuditLog

### 7.3 CheatSheet主要フィールド例

* id（UUID）
* slug（ユニーク）
* title
* summary
* body（Markdown）
* status（draft/published/archived）
* category_id
* tags（多対多）
* target_name（例：Python）
* target_version（任意）
* version（整数）
* created_by / updated_by
* created_at / updated_at / published_at

---

## 8. 業務フロー（運用フロー）

### 8.1 追加・公開フロー（例：承認なし）

1. Editorが新規作成→draft保存
2. プレビュー確認
3. Adminが内容確認→publishedに変更
4. 公開URLが有効化

### 8.2 更新フロー

1. Editorが編集→保存（Revision生成）
2. 既存publishedに即時反映するか、レビュー後反映するかを選択

   * 小規模：即時反映でも可
   * 中規模：staging/approval（review）ステータス推奨

### 8.3 アーカイブ/削除

* 原則 archived（論理削除）で運用
* 完全削除はAdminのみ、かつ復旧不可の警告（仕様）

---

## 9. 画面（UI）以外の入出力仕様

UIの見た目は考えない一方で、「何が入力でき、何が出力されるか」は要件化します。

### 9.1 入力

* Markdown本文
* Front matter（メタ情報）
* タグ/カテゴリ選択
* 公開状態変更
* 参考リンク（複数、URL形式バリデーション）

### 9.2 出力

* HTMLレンダリング（サニタイズ済み）
* メタタグ（description/OG）
* 構造化データ（任意：Article等）

---

## 10. 制約・方針（決めておくと制作が速い）

* スラッグ命名規則（例：`python-basics`、`git-rebase`）
* タグ命名規則（小文字、ハイフン、同義語はaliasへ）
* Markdownの許可機能（例：HTML直書き禁止）
* チートシートの最小テンプレ（必須セクション）

  * 概要 / 基本文法 / よくあるミス / 参考リンク
* 公開の可否（即時 or 承認制）

---

## 11. MVP（最小リリース）定義

「まず出す」ための最小セット。

### MVP必須

* 公開チートシートの閲覧
* タグ/カテゴリでの一覧
* 検索（タイトル+本文の簡易全文検索）
* 編集者ログイン
* チートシートCRUD（draft/published）
* Revision（履歴）※最低限
* 監査ログ（公開・削除など重要操作のみ）
* Markdownサニタイズ

### MVP後（拡張）

* 高度な検索（検索エンジン導入）
* 多言語
* 人気順、ブックマーク
* 承認フロー（review）
* インポート/エクスポート（Markdown一括）

---

## 12. 受け入れテスト観点（例）

* 権限

  * Guestがdraftを閲覧できない
  * Editorが他者のpublishedを編集できるか（方針通り）
* データ整合性

  * slug重複不可
  * タグ統合後、参照が正しく付け替わる
* セキュリティ

  * Markdownにscriptを埋めても実行されない
  * 管理APIに未認証でアクセスできない
* 運用

  * バックアップから復元できる
  * ロールバックで過去版に戻る

---

## 13. リスクと対策（制作前に潰す）

* **MarkdownのXSS**：サニタイズライブラリ必須、許可タグ制限
* **タグが増えすぎて破綻**：辞書管理、統合機能、命名規則
* **検索が重い**：MVPは簡易、後から検索基盤を差し替え可能に
* **更新ルールが曖昧**：公開フロー、責任者（Admin）を決める
* **情報の正確性**：公式リンク必須、更新日時表示、対象バージョン明記

---

## 14. 実装方式の推奨（要件としての“選択肢”）

※ここは「決定」ではなく、制作しやすくするための指針です。

### 方式A：ファイルベース（Markdown管理）+ 静的/ハイブリッド配信

* 強み：運用が軽い、Gitで履歴管理が自然、コスト低
* 課題：ブラウザ上編集（CMS）が欲しい場合は別途仕組みが必要

### 方式B：DB管理（ヘッドレスCMS or 独自CMS）

* 強み：ブラウザ上で完結、権限・ワークフロー強い
* 課題：初期構築はやや重い

---

# 付録A：チートシートの標準テンプレ（推奨）

* 概要（このページで分かること）
* 最小例（Hello World/最小コマンド）
* よく使う構文（箇条書き＋例）
* 典型パターン（配列、辞書、ループ、例外等）
* よくある落とし穴（間違い・非推奨）
* 参考リンク（公式優先）
* 関連チートシート

---

# 付録B：要件確定のために“決めるべき論点”（質問ではなく論点リスト）

※今すぐ回答がなくても進められる順に並べています。

* 公開フロー：即時公開 or 承認制
* 編集方法：ブラウザ編集が必須か（必須ならDB/CMS寄り）
* 多言語：最初から必要か、後でいいか
* 対象範囲：言語だけか、ツール/フレームワークも含むか
* 検索：簡易で十分か、高速全文検索が必須か
* 収益化/広告：将来ありうるか（あれば設計に影響）

---

必要なら、この要件定義をベースにして次の成果物もそのまま作れます（UIは抜きで）：

* **DBテーブル定義（DDL案）**
* **API仕様書（OpenAPI/Swagger叩き台）**
* **運用設計（バックアップ、権限、レビュー手順）**
* **MVPの開発タスク分解（チケット一覧）**

このまま「ファイルベースでいきたい」「ブラウザ編集を必須にしたい」など、制作方針がどちら寄りかだけ教えてくれたら、上の要件を崩さずに**実装へ直結する設計（データ/API/運用）**に落とし込みます。
